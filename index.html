<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI Emotion Recognition - AI & Robotics Club</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- üëá Added face-api.js -->
  <script defer src="https://cdn.jsdelivr.net/npm/face-api.js"></script>
  <style>
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    .animate-pulse {
      animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }
  </style>
</head>
<body class="bg-black text-white">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useRef, useEffect } = React;

    const EmotionQuoteApp = () => {
      const [emotion, setEmotion] = useState('neutral');
      const [quote, setQuote] = useState('');
      const [isWebcamActive, setIsWebcamActive] = useState(false);
      const [error, setError] = useState('');
      const videoRef = useRef(null);
      const streamRef = useRef(null);

      const quotes = {
        happy: [
          "Your smile is contagious! Keep spreading that joy! üòä",
          "Happiness looks beautiful on you! ‚ú®",
          "The world is brighter because of your smile! üåü",
          "Your positive energy is inspiring! Keep shining! ‚òÄÔ∏è",
          "Joy is the best makeup‚Äîyou're wearing it perfectly! üí´"
        ],
        sad: [
          "Every storm runs out of rain. This too shall pass. üåà",
          "You are stronger than you know. Better days are coming. üí™",
          "It's okay to not be okay. Take your time, you've got this. üå∏",
          "Tough times don't last, but tough people do. You're one of them. üåª",
          "The sun will rise again, and so will you. üåÖ"
        ],
        mad: [
          "Take a deep breath. You have the power to choose peace. üåä",
          "Your calm mind is your superpower. You've got this. üßò",
          "This feeling is temporary. Your peace is permanent. Choose it. ‚òÆÔ∏è",
          "Let it go. You deserve tranquility and happiness. üïäÔ∏è",
          "Breathe in calm, breathe out frustration. You're in control. üå¨Ô∏è"
        ],
        neutral: [
          "You are exactly where you need to be right now. üåü",
          "Every moment is a fresh beginning. Make it count! ‚è≥",
          "Your potential is limitless. Believe in yourself! üíé",
          "Today is full of possibilities. Embrace them! üåà",
          "You are capable of amazing things! üíé"
        ]
      };

      const emotionColors = {
        happy: 'from-cyan-400 via-blue-500 to-purple-600',
        sad: 'from-blue-600 via-indigo-700 to-purple-800',
        mad: 'from-red-500 via-pink-600 to-purple-700',
        neutral: 'from-indigo-500 via-purple-600 to-pink-600'
      };

      // üß† Load face-api models
      useEffect(() => {
        const loadModels = async () => {
          try {
            await faceapi.nets.tinyFaceDetector.loadFromUri('/model');
            await faceapi.nets.faceExpressionNet.loadFromUri('/model');
            console.log("Models loaded ‚úÖ");
          } catch (err) {
            console.error("Error loading models:", err);
          }
        };
        loadModels();
      }, []);

      useEffect(() => {
        setQuote(quotes[emotion][Math.floor(Math.random() * quotes[emotion].length)]);
      }, [emotion]);

      const startWebcam = async () => {
        try {
          const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' } });
          if (videoRef.current) {
            videoRef.current.srcObject = stream;
            streamRef.current = stream;
            setIsWebcamActive(true);
            setError('');
            detectEmotions();
          }
        } catch (err) {
          setError('Unable to access webcam. Please grant camera permissions.');
          console.error('Webcam error:', err);
        }
      };

      const stopWebcam = () => {
        if (streamRef.current) {
          streamRef.current.getTracks().forEach(track => track.stop());
          streamRef.current = null;
        }
        if (videoRef.current) videoRef.current.srcObject = null;
        setIsWebcamActive(false);
      };

      // üéØ Real emotion detection using face-api.js
      const detectEmotions = async () => {
        const interval = setInterval(async () => {
          if (!videoRef.current || !streamRef.current) {
            clearInterval(interval);
            return;
          }
          try {
            const detections = await faceapi
              .detectSingleFace(videoRef.current, new faceapi.TinyFaceDetectorOptions())
              .withFaceExpressions();

            if (detections && detections.expressions) {
              const detectedEmotion = Object.keys(detections.expressions)
                .reduce((a, b) => detections.expressions[a] > detections.expressions[b] ? a : b);
              setEmotion(detectedEmotion);
            }
          } catch (err) {
            console.error("Detection error:", err);
          }
        }, 2000);
      };

      return (
        <div className="min-h-screen bg-black relative overflow-hidden">
          <div className="absolute inset-0 opacity-60">
            <div className="absolute inset-0 bg-gradient-to-b from-indigo-900 via-purple-900 to-black"></div>
          </div>

          <div className="relative z-10 p-8">
            <div className="max-w-6xl mx-auto">
              <div className="text-center mb-8">
                <h1 className="text-5xl font-bold bg-gradient-to-r from-cyan-400 via-purple-400 to-pink-400 bg-clip-text text-transparent mb-4">
                  ‚ú® AI Emotion Recognition ‚ú®
                </h1>
                <p className="text-cyan-300 text-lg font-light tracking-wide">
                  ü§ñ AI & Robotics Club ‚Ä¢ Neural Network Emotion Analysis üöÄ
                </p>
              </div>

              <div className="grid md:grid-cols-2 gap-8">
                <div className="bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900 rounded-2xl shadow-2xl p-6 border-2 border-cyan-500 border-opacity-30 backdrop-blur-sm">
                  <div className="flex items-center justify-between mb-4">
                    <h2 className="text-2xl font-semibold text-cyan-300">üìπ Camera Feed</h2>
                  </div>

                  <div className="relative bg-black rounded-xl overflow-hidden aspect-video mb-4 border-2 border-purple-500 border-opacity-40">
                    {!isWebcamActive ? (
                      <div className="absolute inset-0 flex items-center justify-center bg-gradient-to-br from-gray-900 to-black">
                        <div className="text-center">
                          <div className="text-6xl mb-4 animate-pulse">üì∑</div>
                          <p className="text-cyan-300">Neural Network Standby</p>
                        </div>
                      </div>
                    ) : (
                      <>
                        <video
                          ref={videoRef}
                          autoPlay
                          playsInline
                          muted
                          className="w-full h-full object-cover"
                        />
                        <div className="absolute top-0 left-0 right-0 bottom-0 border-4 border-cyan-500 opacity-30 pointer-events-none"></div>
                        <div className="absolute top-2 left-2 bg-black bg-opacity-70 px-3 py-1 rounded text-cyan-400 text-sm font-mono">
                          üü¢ SCANNING...
                        </div>
                      </>
                    )}
                  </div>

                  {error && (
                    <div className="bg-red-900 bg-opacity-50 border border-red-500 text-red-300 px-4 py-3 rounded mb-4">
                      {error}
                    </div>
                  )}

                  <button
                    onClick={isWebcamActive ? stopWebcam : startWebcam}
                    className={`w-full py-3 px-6 rounded-xl font-semibold text-white transition-all transform hover:scale-105 shadow-lg ${
                      isWebcamActive
                        ? 'bg-gradient-to-r from-red-600 to-pink-600 hover:from-red-700 hover:to-pink-700'
                        : 'bg-gradient-to-r from-cyan-500 via-blue-600 to-purple-600 hover:from-cyan-600 hover:via-blue-700 hover:to-purple-700'
                    }`}
                  >
                    {isWebcamActive ? '‚èπ Deactivate Neural Scan' : '‚ñ∂ Activate Neural Scan'}
                  </button>

                  {isWebcamActive && (
                    <p className="text-sm text-cyan-400 mt-4 text-center font-mono">
                      ‚ö° AI Model: Real Emotion Detection Active
                    </p>
                  )}
                </div>

                <div className="space-y-6">
                  <div className={`bg-gradient-to-br ${emotionColors[emotion]} rounded-2xl shadow-2xl p-8 text-white transform transition-all duration-500 border-2 border-white border-opacity-20`}>
                    <div className="text-center">
                      <div className="text-6xl mb-4">
                        {emotion === 'happy' && 'üòä'}
                        {emotion === 'sad' && 'üò¢'}
                        {emotion === 'mad' && 'üò†'}
                        {emotion === 'neutral' && 'üòê'}
                      </div>
                      <h2 className="text-2xl font-bold mb-2 font-mono tracking-wider">DETECTED STATE</h2>
                      <p className="text-6xl font-extrabold capitalize tracking-wide drop-shadow-lg">{emotion}</p>
                    </div>
                  </div>

                  <div className="bg-gradient-to-br from-gray-900 via-indigo-900 to-gray-900 rounded-2xl shadow-2xl p-8 border-2 border-purple-500 border-opacity-30">
                    <h3 className="text-2xl font-semibold text-transparent bg-gradient-to-r from-cyan-400 to-purple-400 bg-clip-text mb-4 text-center">
                      ‚ú® AI-Generated Inspiration
                    </h3>
                    <p className="text-xl text-cyan-100 leading-relaxed px-4 py-4 text-center font-medium">
                      {quote}
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    };

    ReactDOM.render(<EmotionQuoteApp />, document.getElementById("root"));
  </script>
</body>
</html>
